<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KALNET Operations | College ERP</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        /* ============================================
           CSS RESET & BASE STYLES
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Color palette - KALNET theme */
            --primary: #4a90e2;
            --primary-dark: #357abd;
            --secondary: #64748b;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;

            /* Neutrals */
            --white: #ffffff;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;

            /* Layout - Matching Student Portal */
            --sidebar-width: 280px;
            --topbar-height: 64px;

            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f8f9fc 0%, #eef2f7 100%);
            color: #1a202c;
            line-height: 1.5;
            transition: background 0.3s cubic-bezier(0.4, 0, 0.2, 1), color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.01em;
        }

        /* Dark Mode Base */
        body.dark-mode {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e4e6eb;
        }

        /* Dark Mode Overrides - Matching Student Portal */
        body.dark-mode .sidebar {
            background: rgba(26, 31, 46, 0.95);
            border-color: rgba(42, 48, 65, 0.5);
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .topbar {
            background: rgba(26, 31, 46, 0.95);
            border-color: rgba(42, 48, 65, 0.5);
        }

        body.dark-mode .card,
        body.dark-mode .stat-card,
        body.dark-mode .login-card {
            background: rgba(26, 31, 46, 0.95) !important;
            border-color: rgba(42, 48, 65, 0.6);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .card:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .card-header {
            border-bottom-color: #2a3041;
        }

        body.dark-mode .card-title,
        body.dark-mode .page-title,
        body.dark-mode .login-header h2 {
            color: #ffffff;
        }

        body.dark-mode .login-header p {
            color: #8b92a8;
        }

        body.dark-mode .sidebar-nav a {
            color: #b4b9c7;
        }

        body.dark-mode .sidebar-nav a:hover {
            background: rgba(74, 144, 226, 0.12);
            color: #6ba3f0;
        }

        body.dark-mode .sidebar-nav a.active {
            background: rgba(74, 144, 226, 0.16);
            color: #6ba3f0;
            border-left-color: #6ba3f0;
        }

        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background: #1a1f2e;
            border-color: #2a3041;
            color: #e4e6eb;
        }

        body.dark-mode .sidebar-footer {
            border-color: rgba(42, 48, 65, 0.5);
        }

        body.dark-mode .logout-btn {
            border-color: rgba(42, 48, 65, 0.8);
            color: #b4b9c7;
        }

        /* ============================================
           LOGIN SCREEN STYLES
           ============================================ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
        }

        .login-box {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            padding: 40px;
            width: 100%;
            max-width: 400px;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo h1 {
            color: var(--primary);
            font-size: 24px;
            margin-bottom: 8px;
        }

        .login-logo p {
            color: var(--gray-500);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--gray-700);
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #16a34a;
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--white);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-block {
            width: 100%;
        }

        /* ============================================
           APP SHELL STYLES
           ============================================ */
        .app-container {
            display: none;
            min-height: 100vh;
        }

        .app-container.active {
            display: block;
        }

        /* ============================================
           LOGIN & LANDING STYLES (MATCHING INDEX.HTML)
           ============================================ */
        .pre-login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #4a90e2;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .pre-login-container::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: moveGrid 20s linear infinite;
        }

        @keyframes moveGrid {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(50px, 50px);
            }
        }

        body.dark-mode .pre-login-container {
            background: #2874b5;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 48px 40px;
            width: 100%;
            max-width: 440px;
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 1;
        }

        body.dark-mode .login-card {
            background: rgba(26, 31, 46, 0.95);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.5);
        }

        .login-header {
            text-align: center;
            margin-bottom: 36px;
        }

        .login-header h2 {
            font-size: 32px;
            font-weight: 800;
            color: #1a202c;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        body.dark-mode .login-header h2 {
            color: #ffffff;
        }

        .login-header p {
            font-size: 14px;
            color: #718096;
        }

        body.dark-mode .login-header p {
            color: #8b92a8;
        }

        /* Sidebar Footer (Logout) Styles */
        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid rgba(232, 236, 243, 0.5);
            margin-top: auto;
        }

        body.dark-mode .sidebar-footer {
            border-color: rgba(42, 48, 65, 0.5);
        }

        .logout-btn {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid rgba(232, 236, 243, 0.8);
            color: #4a5568;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        body.dark-mode .logout-btn {
            border-color: rgba(42, 48, 65, 0.8);
            color: #b4b9c7;
        }

        .logout-btn:hover {
            background: rgba(231, 76, 60, 0.08);
            border-color: #e74c3c;
            color: #e74c3c;
        }

        /* Top Bar */
        .topbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--topbar-height);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(232, 236, 243, 0.5);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 28px;
            z-index: 100;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .topbar-brand {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }

        .role-switcher {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--gray-100);
            padding: 4px;
            border-radius: 8px;
        }

        .role-switcher button {
            padding: 6px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: var(--gray-600);
        }

        .role-switcher button.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--gray-600);
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .notification-btn:hover {
            background: var(--gray-100);
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--danger);
            color: var(--white);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .user-menu:hover {
            background: var(--gray-100);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 500;
            font-size: 14px;
        }

        .user-info {
            text-align: left;
        }

        .user-name {
            font-weight: 500;
            font-size: 14px;
        }

        .user-role {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(232, 236, 243, 0.5);
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.04);
            overflow-y: auto;
            padding: 0;
            z-index: 90;
            padding-top: var(--topbar-height);
            display: flex;
            flex-direction: column;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-title {
            padding: 0 20px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-400);
            margin-bottom: 8px;
        }

        .sidebar-nav {
            list-style: none;
        }

        .sidebar-nav li {
            margin: 2px 8px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            color: #4a5568;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid transparent;
        }

        .sidebar-nav a:hover {
            background: rgba(74, 144, 226, 0.08);
            color: #4a90e2;
        }

        .sidebar-nav a.active {
            background: rgba(74, 144, 226, 0.12);
            color: #4a90e2;
            border-left-color: #4a90e2;
            font-weight: 600;
            border-radius: 0;
        }

        .sidebar-nav .icon {
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .sidebar-nav .icon svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--topbar-height);
            padding: 24px;
            min-height: calc(100vh - var(--topbar-height));
        }

        /* ============================================
           PAGE STYLES
           ============================================ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .page-subtitle {
            color: var(--gray-500);
            font-size: 14px;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(232, 236, 243, 0.6);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(232, 236, 243, 0.6);
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.04);
            padding: 20px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(74, 144, 226, 0.15);
            border-color: rgba(74, 144, 226, 0.3);
        }

        .stat-label {
            font-size: 13px;
            color: var(--gray-500);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--gray-800);
        }

        .stat-change {
            font-size: 12px;
            margin-top: 4px;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            background: var(--gray-50);
            font-weight: 500;
            font-size: 13px;
            color: var(--gray-600);
        }

        td {
            font-size: 14px;
        }

        tr:hover {
            background: var(--gray-50);
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #fef3c7;
            color: #d97706;
        }

        .status-in-progress {
            background: #dbeafe;
            color: #2563eb;
        }

        .status-completed {
            background: #dcfce7;
            color: #16a34a;
        }

        .status-overdue {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-approved {
            background: #d1fae5;
            color: #059669;
        }

        .status-rejected {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Priority Badges */
        .priority-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high {
            background: #fee2e2;
            color: #dc2626;
        }

        .priority-medium {
            background: #fef3c7;
            color: #d97706;
        }

        .priority-low {
            background: #dcfce7;
            color: #16a34a;
        }

        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {

            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        /* Task List */
        .task-list {
            list-style: none;
        }

        .task-item {
            padding: 16px;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .task-item:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.15);
            transform: translateX(4px);
            background: rgba(74, 144, 226, 0.04);
        }

        .task-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .task-item-title {
            font-weight: 500;
            color: var(--gray-800);
        }

        .task-item-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--gray-500);
        }

        /* Team Member Card */
        .team-member-card {
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
        }

        .team-member-avatar {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 24px;
            font-weight: 500;
            margin: 0 auto 12px;
        }

        .team-member-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .team-member-role {
            font-size: 13px;
            color: var(--gray-500);
            margin-bottom: 12px;
        }

        .team-member-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 13px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray-400);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Dropdown */
        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            display: none;
            z-index: 100;
        }

        .dropdown-menu.active {
            display: block;
        }

        .dropdown-item {
            padding: 10px 16px;
            display: block;
            color: var(--gray-700);
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: var(--gray-100);
        }

        .dropdown-divider {
            border-top: 1px solid var(--gray-200);
            margin: 4px 0;
        }

        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: var(--topbar-height);
            right: 0;
            width: 360px;
            max-height: calc(100vh - var(--topbar-height));
            background: var(--white);
            border-left: 1px solid var(--gray-200);
            box-shadow: var(--shadow-lg);
            z-index: 99;
            display: none;
            overflow-y: auto;
        }

        .notification-panel.active {
            display: block;
        }

        .notification-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-list {
            list-style: none;
        }

        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: var(--gray-50);
        }

        .notification-item.unread {
            background: #eff6ff;
        }

        .notification-content {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .notification-time {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Task Detail */
        .task-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .task-detail-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .task-detail-actions {
            display: flex;
            gap: 8px;
        }

        .task-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .task-info-item {
            padding: 12px;
            background: var(--gray-50);
            border-radius: 8px;
        }

        .task-info-label {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        .task-info-value {
            font-weight: 500;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gray-200);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 4px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid var(--white);
        }

        .timeline-time {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        .timeline-content {
            font-size: 14px;
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-input {
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Reports */
        .chart-placeholder {
            height: 200px;
            background: var(--gray-100);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-500);
            font-size: 14px;
        }

        /* Clickable rows */
        .clickable-row {
            cursor: pointer;
        }

        /* Action buttons in tables */
        .table-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 4px 8px;
            background: none;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
        }

        .toast {
            background: var(--gray-800);
            color: var(--white);
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 8px;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ============================================
           DARK MODE STYLES
           ============================================ */
        body.dark-mode .login-container {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
        }

        body.dark-mode .login-box {
            background: #1a1f2e;
            border: 1px solid #2a3041;
        }

        body.dark-mode .login-logo h1 {
            color: #4a90e2;
        }

        body.dark-mode .login-logo p {
            color: #8b92a8;
        }

        body.dark-mode .form-group label {
            color: #b4b9c7;
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background: rgba(15, 20, 35, 0.5);
            border-color: #2a3041;
            color: #e4e6eb;
        }

        body.dark-mode .topbar {
            background: #1a1f2e;
            border-bottom-color: #2a3041;
        }

        body.dark-mode .role-switcher {
            background: #2a3041;
        }

        body.dark-mode .role-switcher button {
            color: #b4b9c7;
        }

        body.dark-mode .role-switcher button.active {
            background: #1a1f2e;
            color: #4a90e2;
        }

        body.dark-mode .notification-btn {
            color: #b4b9c7;
        }

        body.dark-mode .notification-btn:hover {
            background: #2a3041;
        }

        body.dark-mode .user-menu:hover {
            background: #2a3041;
        }

        body.dark-mode .user-name {
            color: #ffffff;
        }

        body.dark-mode .user-role {
            color: #8b92a8;
        }

        body.dark-mode .sidebar {
            background: #1a1f2e;
            border-right-color: #2a3041;
        }

        body.dark-mode .sidebar-nav a {
            color: #b4b9c7;
        }

        body.dark-mode .sidebar-nav a:hover {
            background: #2a3041;
            color: #ffffff;
        }

        body.dark-mode .sidebar-nav a.active {
            background: #4a90e2;
            color: #ffffff;
        }

        body.dark-mode .main-content {
            background: #0a0e27;
        }

        body.dark-mode .card {
            background: #1a1f2e;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .card-header {
            border-bottom-color: #2a3041;
        }

        body.dark-mode .stat-card {
            background: #1a1f2e;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .stat-value {
            color: #ffffff;
        }

        body.dark-mode .page-title {
            color: #ffffff;
        }

        body.dark-mode th {
            background: #2a3041;
            color: #b4b9c7;
        }

        body.dark-mode td {
            border-bottom-color: #2a3041;
        }

        body.dark-mode tr:hover {
            background: #2a3041;
        }

        body.dark-mode .modal {
            background: #1a1f2e;
        }

        body.dark-mode .modal-header,
        body.dark-mode .modal-footer {
            border-color: #2a3041;
        }

        body.dark-mode .notification-panel {
            background: #1a1f2e;
            border-left-color: #2a3041;
        }

        body.dark-mode .notification-header {
            border-bottom-color: #2a3041;
        }

        body.dark-mode .notification-item {
            border-bottom-color: #2a3041;
        }

        body.dark-mode .notification-item:hover {
            background: #2a3041;
        }

        body.dark-mode .notification-item.unread {
            background: rgba(74, 144, 226, 0.15);
        }

        body.dark-mode .task-item {
            border-color: #2a3041;
        }

        body.dark-mode .task-item:hover {
            border-color: #4a90e2;
        }

        body.dark-mode .task-item-title {
            color: #ffffff;
        }

        body.dark-mode .team-member-card {
            background: #1a1f2e;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .team-member-name {
            color: #ffffff;
        }

        body.dark-mode .dropdown-menu {
            background: #1a1f2e;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }

        body.dark-mode .dropdown-item {
            color: #b4b9c7;
        }

        body.dark-mode .dropdown-item:hover {
            background: #2a3041;
        }

        body.dark-mode .dropdown-divider {
            border-top-color: #2a3041;
        }

        body.dark-mode .task-info-item {
            background: #2a3041;
        }

        body.dark-mode .progress-bar {
            background: #2a3041;
        }

        body.dark-mode .filter-input {
            background: #1a1f2e;
            border-color: #2a3041;
            color: #e4e6eb;
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gray-100);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background: var(--primary);
            color: var(--white);
            transform: rotate(20deg);
        }

        body.dark-mode .theme-toggle {
            background: #2a3041;
        }

        body.dark-mode .theme-toggle:hover {
            background: #4a90e2;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-500);
            text-decoration: none;
            font-size: 13px;
            margin-bottom: 20px;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: var(--primary);
        }

        /* ============================================
           EXECUTOR-SPECIFIC STYLES (Clarity First)
           ============================================ */

        /* Instruction Box - "What you need to do" */
        .instruction-box {
            background: linear-gradient(135deg, #e8f4fd 0%, #d1e9fa 100%);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .instruction-box h3 {
            color: var(--primary);
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .instruction-box ol {
            margin-left: 20px;
            color: var(--gray-700);
            font-size: 16px;
            line-height: 2;
        }

        .instruction-box li {
            margin-bottom: 8px;
        }

        body.dark-mode .instruction-box {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.2) 0%, rgba(74, 144, 226, 0.1) 100%);
            border-color: var(--primary);
        }

        body.dark-mode .instruction-box ol {
            color: #e4e6eb;
        }

        /* Completion Hint */
        .completion-hint {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 16px 20px;
            margin-bottom: 24px;
            font-size: 15px;
            color: #92400e;
            border-radius: 0 8px 8px 0;
        }

        body.dark-mode .completion-hint {
            background: rgba(245, 158, 11, 0.15);
            color: #fcd34d;
        }

        /* Large Executor Buttons */
        .executor-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 20px 40px;
            font-size: 18px;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 200px;
        }

        .executor-btn-primary {
            background: var(--success);
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .executor-btn-primary:hover {
            background: #16a34a;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
        }

        .executor-btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .executor-btn-secondary:hover {
            background: var(--gray-300);
        }

        .executor-btn-danger {
            background: var(--danger);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .executor-btn-danger:hover {
            background: #dc2626;
        }

        body.dark-mode .executor-btn-secondary {
            background: #2a3041;
            color: #e4e6eb;
        }

        /* Large Task Cards for Executor */
        .task-card-large {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-card-large:hover {
            border-color: var(--primary);
            box-shadow: 0 8px 24px rgba(74, 144, 226, 0.15);
            transform: translateY(-2px);
        }

        body.dark-mode .task-card-large {
            background: #1a1f2e;
            border-color: #2a3041;
        }

        body.dark-mode .task-card-large:hover {
            border-color: var(--primary);
        }

        .task-card-large-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 12px;
        }

        body.dark-mode .task-card-large-title {
            color: #ffffff;
        }

        .task-card-large-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            font-size: 14px;
            color: var(--gray-500);
            margin-bottom: 16px;
        }

        .task-card-large-action {
            display: flex;
            justify-content: flex-end;
        }

        /* Section Headers for Executor Dashboard */
        .executor-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .executor-section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body.dark-mode .executor-section-title {
            color: #ffffff;
        }

        .executor-filter {
            display: flex;
            gap: 8px;
        }

        .executor-filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            background: var(--white);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .executor-filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        body.dark-mode .executor-filter-btn {
            background: #2a3041;
            border-color: #3a4051;
            color: #e4e6eb;
        }

        body.dark-mode .executor-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Empty State for Executor */
        .executor-empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .executor-empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .executor-empty-state-text {
            font-size: 18px;
        }

        /* Cannot Complete Reason Field */
        .reason-field {
            margin-top: 16px;
            display: none;
        }

        .reason-field.active {
            display: block;
        }

        .reason-field textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--danger);
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }

        .reason-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--danger);
        }

        /* Action Buttons Container */
        .executor-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 24px;
        }
    </style>
</head>

<body>
    <!-- ============================================
         LOGIN SCREEN
         ============================================ -->
    <!-- ============================================
         LOGIN SCREEN (Redesigned)
         ============================================ -->
    <!-- ============================================
         MAIN APPLICATION (Login bypassed)
         ============================================ -->
    <div id="appContainer" class="app-container active">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <a href="index.html" class="topbar-brand">üè´ KALNET Operations</a>

                <!-- Role Switcher (Demo Only) -->
                <div class="role-switcher">
                    <span style="font-size: 11px; color: var(--gray-500); margin-right: 8px;">Demo:</span>
                    <button id="roleBtnAssigner" class="active" onclick="switchRole('assigner')">
                        <svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; margin-right: 4px;">
                            <path
                                d="M20 6c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6zm-2 0l-6 5-6-5h12zm0 12H6V8l6 5 6-5v10z" />
                        </svg> Assigner
                    </button>
                    <button id="roleBtnExecutor" onclick="switchRole('executor')">
                        <svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; margin-right: 4px;">
                            <path
                                d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z" />
                        </svg> Staff
                    </button>
                </div>
            </div>

            <div class="topbar-right">
                <!-- Theme Toggle -->
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode">
                    <span id="themeIcon"><svg viewBox="0 0 24 24" width="18" height="18" style="fill: currentColor;">
                            <path
                                d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z" />
                        </svg></span>
                </button>

                <!-- Notifications -->
                <button class="notification-btn" onclick="toggleNotifications()">
                    <svg viewBox="0 0 24 24" width="20" height="20" style="fill: currentColor;">
                        <path
                            d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z" />
                    </svg>
                    <span id="notificationBadge" class="notification-badge">3</span>
                </button>
                <div id="notificationsDropdown" class="dropdown-menu notification-dropdown"
                    style="width: 320px; right: 80px;">
                    <div class="dropdown-header"
                        style="padding: 12px 16px; border-bottom: 1px solid var(--gray-100); font-weight: 600;">
                        Notifications
                    </div>
                    <div id="notificationsList" style="max-height: 300px; overflow-y: auto;">
                        <!-- Populated by JS -->
                    </div>
                    <div class="dropdown-footer"
                        style="padding: 8px; text-align: center; border-top: 1px solid var(--gray-100);">
                        <a href="#" onclick="navigateTo('notifications'); toggleNotifications();"
                            style="font-size: 13px; color: var(--primary); text-decoration: none;">View All</a>
                    </div>
                </div>

                <!-- User Menu -->
                <div class="dropdown">
                    <div class="user-menu" onclick="toggleUserMenu()">
                        <div class="user-avatar" id="userAvatar">AD</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">Admin User</div>
                            <div class="user-role" id="userRoleDisplay">Assigner</div>
                        </div>
                    </div>
                    <div id="userDropdown" class="dropdown-menu">
                        <a class="dropdown-item" onclick="navigateTo('profile')">
                            <svg viewBox="0 0 24 24" width="16" height="16"
                                style="fill: currentColor; margin-right: 8px;">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
                            </svg>Profile
                        </a>
                        <a class="dropdown-item" onclick="navigateTo('notifications')">
                            <svg viewBox="0 0 24 24" width="16" height="16"
                                style="fill: currentColor; margin-right: 8px;">
                                <path
                                    d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z" />
                            </svg>Notifications
                        </a>
                        <a class="dropdown-item" href="index.html">
                            <svg viewBox="0 0 24 24" width="16" height="16"
                                style="fill: currentColor; margin-right: 8px;">
                                <path d="M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z" />
                            </svg>Back to Main Portal
                        </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" onclick="logout()">
                            <svg viewBox="0 0 24 24" width="16" height="16"
                                style="fill: currentColor; margin-right: 8px;">
                                <path
                                    d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
                            </svg>Logout
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar - Assigner -->
        <nav id="sidebarAssigner" class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Main</div>
                <ul class="sidebar-nav">
                    <li><a href="#" class="active" data-page="assigner-dashboard"><span class="icon"><svg
                                    viewBox="0 0 24 24">
                                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                                </svg></span> Dashboard</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Task Management</div>
                <ul class="sidebar-nav">
                    <li><a href="#" data-page="create-task"><span class="icon"><svg viewBox="0 0 24 24">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                                </svg></span> Create Task</a></li>
                    <li><a href="#" data-page="assign-task"><span class="icon"><svg viewBox="0 0 24 24">
                                    <path
                                        d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"
                                        transform="rotate(180 12 12)" />
                                </svg></span> Assign Task</a></li>
                    <li><a href="#" data-page="task-overview"><span class="icon"><svg viewBox="0 0 24 24">
                                    <path
                                        d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
                                </svg></span> Task Overview</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Team</div>
                <ul class="sidebar-nav">
                    <li><a href="#" data-page="team-view"><span class="icon"><svg viewBox="0 0 24 24">
                                    <path
                                        d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                </svg></span> Team View</a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">Analytics</div>
                <ul class="sidebar-nav">
                    <li><a href="#" data-page="reports"><span class="icon"><svg viewBox="0 0 24 24">
                                    <path
                                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                                </svg></span> Reports</a></li>
                </ul>
            </div>
            <div class="sidebar-footer">
                <button onclick="logout()" class="logout-btn">
                    <svg viewBox="0 0 24 24" width="18" height="18" style="fill: currentColor;">
                        <path
                            d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
                    </svg>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Sidebar - Executor (Simplified - Only My Tasks) -->
        <nav id="sidebarExecutor" class="sidebar" style="display: none;">
            <div class="sidebar-section">
                <div class="sidebar-title">My Work</div>
                <ul class="sidebar-nav">
                    <li><a href="#" class="active" data-page="executor-dashboard"><span class="icon"><svg
                                    viewBox="0 0 24 24">
                                    <path
                                        d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
                                </svg></span> My Tasks</a></li>
                </ul>
            </div>
            <div class="sidebar-footer">
                <button onclick="logout()" class="logout-btn">
                    <svg viewBox="0 0 24 24" width="18" height="18" style="fill: currentColor;">
                        <path
                            d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
                    </svg>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Notification Panel -->
        <div id="notificationPanel" class="notification-panel">
            <div class="notification-header">
                <span style="font-weight: 600;">Notifications</span>
                <button class="btn btn-sm btn-secondary" onclick="markAllRead()">Mark all read</button>
            </div>
            <ul class="notification-list" id="notificationList">
                <!-- Dynamically populated -->
            </ul>
        </div>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- ============================================
                 ASSIGNER PAGES
                 ============================================ -->

            <!-- Assigner Dashboard -->
            <div id="page-assigner-dashboard" class="page active">
                <div class="page-header">
                    <h1 class="page-title">Operations Dashboard</h1>
                    <p class="page-subtitle">Overview of all tasks and team performance</p>
                </div>

                <div class="stats-grid" id="assignerStats">
                    <!-- Dynamically populated -->
                </div>

                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Tasks</h3>
                            <button class="btn btn-sm btn-secondary" onclick="navigateTo('task-overview')">View
                                All</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Task</th>
                                        <th>Assigned To</th>
                                        <th>Status</th>
                                        <th>Due Date</th>
                                    </tr>
                                </thead>
                                <tbody id="recentTasksTable">
                                    <!-- Dynamically populated -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Team Performance</h3>
                            <button class="btn btn-sm btn-secondary" onclick="navigateTo('team-view')">View
                                Team</button>
                        </div>
                        <div id="teamPerformanceList">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Task -->
            <div id="page-create-task" class="page">
                <div class="page-header">
                    <h1 class="page-title">Create New Task</h1>
                    <p class="page-subtitle">Define a new task for assignment</p>
                </div>

                <div class="card">
                    <form id="createTaskForm">
                        <div class="form-group">
                            <label>Task Title *</label>
                            <input type="text" id="taskTitle" required placeholder="Enter task title">
                        </div>

                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="taskDescription" rows="4"
                                placeholder="Describe the task in detail"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Priority</label>
                                <select id="taskPriority">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Due Date</label>
                                <input type="date" id="taskDueDate">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Category</label>
                                <select id="taskCategory">
                                    <option value="maintenance">Maintenance</option>
                                    <option value="administrative">Administrative</option>
                                    <option value="facilities">Facilities</option>
                                    <option value="supplies">Supplies</option>
                                    <option value="events">Events</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Estimated Hours</label>
                                <input type="number" id="taskHours" min="1" max="100" value="4">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>üìù Instructions for Staff <span
                                    style="font-weight: 400; color: var(--gray-500);">(What the staff member needs to
                                    do)</span></label>
                            <textarea id="taskStaffInstructions" rows="3" placeholder="Write simple, clear steps. Example:
1. Go to Room 101 in Block A
2. Check and fix the AC unit
3. Once done, click Mark as Done"></textarea>
                            <small style="color: var(--gray-500);">This will be shown to the staff member in their task
                                view</small>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <button type="submit" class="btn btn-primary">Create Task</button>
                            <button type="button" class="btn btn-secondary"
                                onclick="navigateTo('assigner-dashboard')">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Assign Task -->
            <div id="page-assign-task" class="page">
                <div class="page-header">
                    <h1 class="page-title">Assign Tasks</h1>
                    <p class="page-subtitle">Assign unassigned tasks to team members</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Unassigned Tasks</h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Task</th>
                                    <th>Priority</th>
                                    <th>Category</th>
                                    <th>Due Date</th>
                                    <th>Assign To</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="unassignedTasksTable">
                                <!-- Dynamically populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Task Overview -->
            <div id="page-task-overview" class="page">
                <div class="page-header">
                    <h1 class="page-title">Task Overview</h1>
                    <p class="page-subtitle">View and manage all tasks</p>
                </div>

                <div class="filters">
                    <select class="filter-input" id="filterStatus" onchange="filterTasks()">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="overdue">Overdue</option>
                    </select>
                    <select class="filter-input" id="filterPriority" onchange="filterTasks()">
                        <option value="">All Priority</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                    <select class="filter-input" id="filterAssignee" onchange="filterTasks()">
                        <option value="">All Assignees</option>
                        <!-- Dynamically populated -->
                    </select>
                    <button class="btn btn-primary" onclick="navigateTo('create-task')">+ New Task</button>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Task</th>
                                    <th>Assigned To</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                    <th>Due Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="allTasksTable">
                                <!-- Dynamically populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Task Detail (Assigner View) -->
            <div id="page-task-detail-assigner" class="page">
                <div class="page-header">
                    <button class="btn btn-secondary" onclick="history.back()">‚Üê Back</button>
                </div>

                <div id="taskDetailAssignerContent">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Team View -->
            <div id="page-team-view" class="page">
                <div class="page-header">
                    <h1 class="page-title">Team View</h1>
                    <p class="page-subtitle">Non-teaching staff members and their workload</p>
                </div>

                <div class="grid-3" id="teamMembersGrid">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Reports -->
            <div id="page-reports" class="page">
                <div class="page-header">
                    <h1 class="page-title">Reports & Analytics</h1>
                    <p class="page-subtitle">Task completion metrics and performance reports</p>
                </div>

                <div class="stats-grid" id="reportStats">
                    <!-- Dynamically populated -->
                </div>

                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Tasks by Status</h3>
                        </div>
                        <div id="statusChart">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Tasks by Category</h3>
                        </div>
                        <div id="categoryChart">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Team Productivity</h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Team Member</th>
                                    <th>Assigned</th>
                                    <th>Completed</th>
                                    <th>In Progress</th>
                                    <th>Overdue</th>
                                    <th>Completion Rate</th>
                                </tr>
                            </thead>
                            <tbody id="productivityTable">
                                <!-- Dynamically populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ============================================
                 EXECUTOR PAGES
                 ============================================ -->

            <!-- Executor Dashboard (Task-First Design) -->
            <div id="page-executor-dashboard" class="page">
                <div class="page-header">
                    <h1 class="page-title"><svg viewBox="0 0 24 24" width="24" height="24"
                            style="fill: currentColor; vertical-align: middle; margin-right: 8px;">
                            <path
                                d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
                        </svg>My Tasks</h1>
                    <p class="page-subtitle">Here are the jobs assigned to you</p>
                </div>

                <!-- My Tasks for Today -->
                <div class="executor-section-header">
                    <h2 class="executor-section-title"><svg viewBox="0 0 24 24" width="20" height="20"
                            style="fill: currentColor; vertical-align: middle; margin-right: 6px;">
                            <path
                                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10zM5 7V5h14v2H5z" />
                        </svg>Tasks for Today</h2>
                    <div class="executor-filter">
                        <button class="executor-filter-btn active" onclick="filterExecutorTasks('today')">Today</button>
                        <button class="executor-filter-btn" onclick="filterExecutorTasks('all')">All Tasks</button>
                    </div>
                </div>

                <div id="executorTodayTasks">
                    <!-- Dynamically populated with large task cards -->
                </div>

                <!-- All Pending Tasks -->
                <div class="executor-section-header" id="allTasksSection" style="display: none;">
                    <h2 class="executor-section-title">üìã All Pending Tasks</h2>
                </div>

                <div id="executorAllTasks" style="display: none;">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Task Detail (Executor View) -->
            <div id="page-task-detail-executor" class="page">
                <div class="page-header">
                    <button class="btn btn-secondary" onclick="navigateTo('executor-dashboard')">‚Üê Back</button>
                </div>

                <div id="taskDetailExecutorContent">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Update Status -->
            <div id="page-update-status" class="page">
                <div class="page-header">
                    <h1 class="page-title">Update Task Status</h1>
                    <p class="page-subtitle">Update progress on your assigned tasks</p>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Task</th>
                                    <th>Priority</th>
                                    <th>Current Status</th>
                                    <th>Due Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="statusUpdateTable">
                                <!-- Dynamically populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Completed Tasks -->
            <div id="page-completed-tasks" class="page">
                <div class="page-header">
                    <h1 class="page-title">Completed Tasks</h1>
                    <p class="page-subtitle">History of your completed tasks</p>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Task</th>
                                    <th>Category</th>
                                    <th>Completed On</th>
                                    <th>Approval Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="completedTasksTable">
                                <!-- Dynamically populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ============================================
                 SHARED PAGES
                 ============================================ -->

            <!-- Profile -->
            <div id="page-profile" class="page">
                <div class="page-header">
                    <h1 class="page-title">My Profile</h1>
                    <p class="page-subtitle">View and manage your account settings</p>
                </div>

                <div class="card">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 24px;">
                        <div class="user-avatar" style="width: 80px; height: 80px; font-size: 32px;" id="profileAvatar">
                            AD</div>
                        <div>
                            <h2 id="profileName">Admin User</h2>
                            <p style="color: var(--gray-500);" id="profileRole">Assigner / Operations</p>
                        </div>
                    </div>

                    <form id="profileForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="profileFullName" value="Admin User">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="profileEmail" value="admin@school.edu">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Department</label>
                                <input type="text" id="profileDept" value="Operations">
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="profilePhone" value="+1 234 567 8900">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
            </div>

            <!-- Notifications Page -->
            <div id="page-notifications" class="page">
                <div class="page-header">
                    <h1 class="page-title">All Notifications</h1>
                    <p class="page-subtitle">View all your notifications</p>
                </div>

                <div class="card">
                    <ul class="notification-list" id="allNotificationsList" style="max-height: none;">
                        <!-- Dynamically populated -->
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <!-- ============================================
         MODAL: Task Assignment
         ============================================ -->
    <div id="assignModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Assign Task</h3>
                <button class="modal-close" onclick="closeModal('assignModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p id="assignTaskName" style="margin-bottom: 16px; font-weight: 500;"></p>
                <div class="form-group">
                    <label>Select Team Member</label>
                    <select id="assigneeSelect">
                        <!-- Dynamically populated -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="assignNotes" rows="3" placeholder="Add any special instructions..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('assignModal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmAssignment()">Assign Task</button>
            </div>
        </div>
    </div>

    <!-- ============================================
         MODAL: Status Update
         ============================================ -->
    <div id="statusModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Update Status</h3>
                <button class="modal-close" onclick="closeModal('statusModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p id="statusTaskName" style="margin-bottom: 16px; font-weight: 500;"></p>
                <div class="form-group">
                    <label>New Status</label>
                    <select id="newStatusSelect">
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Progress Update</label>
                    <textarea id="statusNotes" rows="3" placeholder="Describe what you've accomplished..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('statusModal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmStatusUpdate()">Update Status</button>
            </div>
        </div>
    </div>

    <!-- ============================================
         TOAST CONTAINER
         ============================================ -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- ============================================
         JAVASCRIPT - Application Logic
         ============================================ -->
    <script>
        // ============================================
        // MOCK DATA STORE
        // ============================================

        // Helper function to generate dates relative to today
        function getRelativeDate(daysFromToday) {
            const date = new Date();
            date.setDate(date.getDate() + daysFromToday);
            return date.toISOString().split('T')[0]; // Returns YYYY-MM-DD format
        }

        // Get today's date in YYYY-MM-DD format
        const today = getRelativeDate(0);
        const yesterday = getRelativeDate(-1);
        const tomorrow = getRelativeDate(1);

        // Central data store - all mock data lives here
        const DataStore = {
            // Current user session
            currentUser: null,
            currentRole: 'assigner',

            // Team members (non-teaching staff)
            teamMembers: [
                { id: 1, name: 'John Smith', role: 'Maintenance Staff', avatar: 'JS', department: 'Facilities', email: 'john@school.edu' },
                { id: 2, name: 'Maria Garcia', role: 'Administrative Assistant', avatar: 'MG', department: 'Admin', email: 'maria@school.edu' },
                { id: 3, name: 'Robert Johnson', role: 'Security Guard', avatar: 'RJ', department: 'Security', email: 'robert@school.edu' },
                { id: 4, name: 'Sarah Williams', role: 'Cleaner', avatar: 'SW', department: 'Facilities', email: 'sarah@school.edu' },
                { id: 5, name: 'Michael Brown', role: 'Lab Assistant', avatar: 'MB', department: 'Science', email: 'michael@school.edu' },
            ],

            // Tasks data
            tasks: [
                {
                    id: 1001,
                    title: 'Fix broken water fountain in Block A',
                    description: 'The water fountain on the second floor of Block A is not working. Need to check the plumbing and fix the issue.',
                    priority: 'high',
                    status: 'in-progress',
                    category: 'maintenance',
                    assigneeId: 1,
                    assignerId: 'admin',
                    createdAt: '2024-01-15T09:00:00',
                    dueDate: today,
                    estimatedHours: 4,
                    timeline: [
                        { time: '2024-01-15 09:00', action: 'Task created by Admin' },
                        { time: '2024-01-15 10:30', action: 'Assigned to John Smith' },
                        { time: '2024-01-16 08:00', action: 'Status changed to In Progress' },
                    ],
                    notes: 'Checked the pipes, found a leak. Waiting for replacement parts.'
                },
                {
                    id: 1002,
                    title: 'Prepare inventory report for supplies',
                    description: 'Create a comprehensive inventory report of all office supplies including stationery, printer ink, and cleaning materials.',
                    priority: 'medium',
                    status: 'pending',
                    category: 'administrative',
                    assigneeId: 2,
                    assignerId: 'admin',
                    createdAt: '2024-01-14T14:00:00',
                    dueDate: today,
                    estimatedHours: 8,
                    timeline: [
                        { time: '2024-01-14 14:00', action: 'Task created by Admin' },
                        { time: '2024-01-14 14:30', action: 'Assigned to Maria Garcia' },
                    ],
                    notes: ''
                },
                {
                    id: 1003,
                    title: 'Security check for evening event',
                    description: 'Conduct security sweep and setup for the annual parents meeting event.',
                    priority: 'high',
                    status: 'completed',
                    category: 'events',
                    assigneeId: 3,
                    assignerId: 'admin',
                    createdAt: '2024-01-12T11:00:00',
                    dueDate: '2024-01-14',
                    completedAt: '2024-01-14T18:00:00',
                    estimatedHours: 6,
                    approvalStatus: 'approved',
                    timeline: [
                        { time: '2024-01-12 11:00', action: 'Task created by Admin' },
                        { time: '2024-01-12 11:30', action: 'Assigned to Robert Johnson' },
                        { time: '2024-01-13 07:00', action: 'Status changed to In Progress' },
                        { time: '2024-01-14 18:00', action: 'Task completed' },
                        { time: '2024-01-14 19:00', action: 'Approved by Admin' },
                    ],
                    notes: 'Event went smoothly. All security protocols followed.'
                },
                {
                    id: 1004,
                    title: 'Deep clean science lab',
                    description: 'Complete deep cleaning of the science laboratory including all equipment surfaces.',
                    priority: 'medium',
                    status: 'pending',
                    category: 'facilities',
                    assigneeId: 4,
                    assignerId: 'admin',
                    createdAt: '2024-01-16T10:00:00',
                    dueDate: tomorrow,
                    estimatedHours: 5,
                    timeline: [
                        { time: '2024-01-16 10:00', action: 'Task created by Admin' },
                        { time: '2024-01-16 10:15', action: 'Assigned to Sarah Williams' },
                    ],
                    notes: ''
                },
                {
                    id: 1005,
                    title: 'Setup equipment for chemistry practical',
                    description: 'Prepare all necessary equipment and chemicals for tomorrow\'s chemistry practical session.',
                    priority: 'high',
                    status: 'in-progress',
                    category: 'supplies',
                    assigneeId: 5,
                    assignerId: 'admin',
                    createdAt: '2024-01-16T13:00:00',
                    dueDate: today,
                    estimatedHours: 3,
                    timeline: [
                        { time: '2024-01-16 13:00', action: 'Task created by Admin' },
                        { time: '2024-01-16 13:10', action: 'Assigned to Michael Brown' },
                        { time: '2024-01-16 14:00', action: 'Status changed to In Progress' },
                    ],
                    notes: 'Gathered most items. Need to prepare HCl solution.'
                },
                {
                    id: 1006,
                    title: 'Replace hallway lights',
                    description: 'Several fluorescent lights in the main hallway need replacement.',
                    priority: 'low',
                    status: 'pending',
                    category: 'maintenance',
                    assigneeId: null,
                    assignerId: 'admin',
                    createdAt: '2024-01-16T15:00:00',
                    dueDate: '2024-01-25',
                    estimatedHours: 2,
                    timeline: [
                        { time: '2024-01-16 15:00', action: 'Task created by Admin' },
                    ],
                    notes: ''
                },
                {
                    id: 1007,
                    title: 'Organize storage room',
                    description: 'Reorganize the main storage room and create an inventory list.',
                    priority: 'low',
                    status: 'pending',
                    category: 'administrative',
                    assigneeId: null,
                    assignerId: 'admin',
                    createdAt: '2024-01-16T16:00:00',
                    dueDate: '2024-01-30',
                    estimatedHours: 6,
                    timeline: [
                        { time: '2024-01-16 16:00', action: 'Task created by Admin' },
                    ],
                    notes: ''
                },
                {
                    id: 1008,
                    title: 'HVAC maintenance check',
                    description: 'Routine maintenance check of HVAC systems in all buildings.',
                    priority: 'medium',
                    status: 'completed',
                    category: 'maintenance',
                    assigneeId: 1,
                    assignerId: 'admin',
                    createdAt: '2024-01-10T09:00:00',
                    dueDate: '2024-01-13',
                    completedAt: '2024-01-13T16:00:00',
                    estimatedHours: 8,
                    approvalStatus: 'pending',
                    timeline: [
                        { time: '2024-01-10 09:00', action: 'Task created by Admin' },
                        { time: '2024-01-10 09:30', action: 'Assigned to John Smith' },
                        { time: '2024-01-11 08:00', action: 'Status changed to In Progress' },
                        { time: '2024-01-13 16:00', action: 'Task completed' },
                    ],
                    notes: 'All units checked. Minor filter replacements done.'
                },
                // Additional tasks for Staff ID 1 (John Smith) for demo
                {
                    id: 1009,
                    title: 'Replace broken door handle in Room 204',
                    description: 'The door handle in classroom 204 is loose and needs replacement.',
                    staffInstructions: '1. Get replacement handle from storage\n2. Remove old handle with screwdriver\n3. Install new handle and test\n4. Report completion',
                    priority: 'medium',
                    status: 'completed',
                    category: 'maintenance',
                    assigneeId: 1,
                    assignerId: 'admin',
                    createdAt: '2024-01-08T09:00:00',
                    dueDate: yesterday,
                    completedAt: yesterday + 'T14:00:00',
                    estimatedHours: 2,
                    approvalStatus: 'approved',
                    timeline: [
                        { time: '2024-01-08 09:00', action: 'Task created by Admin' },
                        { time: '2024-01-08 10:00', action: 'Assigned to John Smith' },
                        { time: yesterday + ' 10:00', action: 'Task completed' },
                    ],
                    notes: 'Door handle replaced successfully.'
                },
                {
                    id: 1010,
                    title: 'Check and repair playground equipment',
                    description: 'Routine safety inspection and minor repairs of playground equipment.',
                    staffInstructions: '1. Inspect all swings and slides\n2. Tighten loose bolts\n3. Check for rust or damage\n4. Report any major issues\n5. Apply lubricant to moving parts',
                    priority: 'high',
                    status: 'in-progress',
                    category: 'maintenance',
                    assigneeId: 1,
                    assignerId: 'admin',
                    createdAt: '2024-01-14T08:00:00',
                    dueDate: tomorrow,
                    estimatedHours: 6,
                    timeline: [
                        { time: '2024-01-14 08:00', action: 'Task created by Admin' },
                        { time: '2024-01-14 08:30', action: 'Assigned to John Smith' },
                        { time: yesterday + ' 09:00', action: 'Status changed to In Progress' },
                    ],
                    notes: 'Started inspection. Found some loose bolts need tightening.'
                },
                {
                    id: 1011,
                    title: 'Install new notice board in staff room',
                    description: 'Install a new cork notice board in the staff room near the entrance.',
                    staffInstructions: '1. Collect notice board from admin office\n2. Mark drilling points (eye level)\n3. Drill holes and insert wall plugs\n4. Mount the board securely\n5. Clean up any debris',
                    priority: 'low',
                    status: 'pending',
                    category: 'facilities',
                    assigneeId: 1,
                    assignerId: 'admin',
                    createdAt: '2024-01-15T14:00:00',
                    dueDate: getRelativeDate(3),
                    estimatedHours: 2,
                    timeline: [
                        { time: '2024-01-15 14:00', action: 'Task created by Admin' },
                        { time: '2024-01-15 14:15', action: 'Assigned to John Smith' },
                    ],
                    notes: ''
                },
            ],

            // Notifications
            notifications: [
                { id: 1, message: 'Task "Fix broken water fountain" is due tomorrow', read: false, time: '5 min ago', taskId: 1001 },
                { id: 2, message: 'John Smith updated status on "Water fountain repair"', read: false, time: '1 hour ago', taskId: 1001 },
                { id: 3, message: 'New task assigned: "Setup equipment for chemistry practical"', read: false, time: '2 hours ago', taskId: 1005 },
                { id: 4, message: 'Robert Johnson completed "Security check for evening event"', read: true, time: '1 day ago', taskId: 1003 },
                { id: 5, message: 'Weekly report is ready for review', read: true, time: '2 days ago', taskId: null },
            ],

            // Next ID for new tasks
            nextTaskId: 1009,

            // Add a task
            addTask(taskData) {
                const newTask = {
                    id: this.nextTaskId++,
                    ...taskData,
                    status: 'pending',
                    assigneeId: null,
                    assignerId: 'admin',
                    createdAt: new Date().toISOString(),
                    timeline: [
                        { time: this.formatDateTime(new Date()), action: 'Task created by Admin' }
                    ],
                    notes: ''
                };
                this.tasks.push(newTask);
                this.addNotification(`New task created: "${newTask.title}"`);
                return newTask;
            },

            // Update task
            updateTask(taskId, updates) {
                const task = this.tasks.find(t => t.id === taskId);
                if (task) {
                    Object.assign(task, updates);
                    return task;
                }
                return null;
            },

            // Add notification
            addNotification(message, taskId = null) {
                this.notifications.unshift({
                    id: Date.now(),
                    message,
                    read: false,
                    time: 'Just now',
                    taskId
                });
                // Update badge if function exists
                if (typeof updateNotificationBadge === 'function') {
                    updateNotificationBadge();
                }
            },

            // Format date helper
            formatDateTime(date) {
                return new Date(date).toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },

            // Get unread notification count
            getUnreadCount() {
                return this.notifications.filter(n => !n.read).length;
            }
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================

        let currentTaskId = null; // For modals
        let previousPage = null; // For back navigation

        // ============================================
        // AUTHENTICATION
        // ============================================

        /**
         * Initialize App (Authentication bypassed - handled by main portal)
         */
        function initOpsPortal() {
            // Set default user
            DataStore.currentUser = {
                id: 'admin',
                name: 'Admin User',
                email: 'admin@school.edu',
                avatar: 'AD'
            };

            // Initialize the dashboard
            switchRole('assigner');
            console.log('Operations portal initialized');
        }

        // Initialize immediately
        initOpsPortal();

        /**
         * Logout and return to login screen
         */
        function logout() {
            DataStore.currentUser = null;
            window.location.href = 'index.html';
        }

        // ============================================
        // ROLE SWITCHING
        // ============================================

        /**
         * Switch between Assigner and Executor roles
         * @param {string} role - 'assigner' or 'executor'
         */
        function switchRole(role) {
            DataStore.currentRole = role;

            // Update role switcher buttons
            document.getElementById('roleBtnAssigner').classList.toggle('active', role === 'assigner');
            document.getElementById('roleBtnExecutor').classList.toggle('active', role === 'executor');

            // Update sidebars
            document.getElementById('sidebarAssigner').style.display = role === 'assigner' ? 'block' : 'none';
            document.getElementById('sidebarExecutor').style.display = role === 'executor' ? 'block' : 'none';

            // Update user role display
            document.getElementById('userRoleDisplay').textContent = role === 'assigner' ? 'Assigner' : 'Executor';

            // Navigate to appropriate dashboard
            if (role === 'assigner') {
                navigateTo('assigner-dashboard');
            } else {
                navigateTo('executor-dashboard');
            }

            showToast(`Switched to ${role === 'assigner' ? 'Assigner' : 'Executor'} view`);
        }

        // ============================================
        // NAVIGATION
        // ============================================

        /**
         * Navigate to a specific page
         * @param {string} pageId - The page identifier
         */
        function navigateTo(pageId) {
            // Store previous page for back navigation
            const currentActive = document.querySelector('.page.active');
            if (currentActive) {
                previousPage = currentActive.id.replace('page-', '');
            }

            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Show target page
            const targetPage = document.getElementById(`page-${pageId}`);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update sidebar active state
            document.querySelectorAll('.sidebar-nav a').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === pageId) {
                    link.classList.add('active');
                }
            });

            // Render page-specific content
            renderPage(pageId);

            // Close any open dropdowns
            closeNotifications();
            closeUserMenu();
        }

        /**
         * Go back to previous page
         */
        window.history.back = function () {
            if (previousPage) {
                navigateTo(previousPage);
            } else {
                navigateTo(DataStore.currentRole === 'assigner' ? 'assigner-dashboard' : 'executor-dashboard');
            }
        };

        // Sidebar navigation click handlers
        document.querySelectorAll('.sidebar-nav a').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                navigateTo(this.dataset.page);
            });
        });

        // ============================================
        // PAGE RENDERING
        // ============================================

        /**
         * Render content for specific pages
         * @param {string} pageId - The page to render
         */
        function renderPage(pageId) {
            switch (pageId) {
                case 'assigner-dashboard':
                    renderAssignerDashboard();
                    break;
                case 'create-task':
                    // Form is static, reset it
                    document.getElementById('createTaskForm').reset();
                    break;
                case 'assign-task':
                    renderAssignTaskPage();
                    break;
                case 'task-overview':
                    renderTaskOverview();
                    break;
                case 'team-view':
                    renderTeamView();
                    break;
                case 'reports':
                    renderReports();
                    break;
                case 'executor-dashboard':
                    renderExecutorDashboard();
                    break;
                case 'update-status':
                    renderUpdateStatusPage();
                    break;
                case 'completed-tasks':
                    renderCompletedTasks();
                    break;
                case 'notifications':
                    renderNotificationsPage();
                    break;
                case 'profile':
                    renderProfile();
                    break;
            }
        }

        // ============================================
        // ASSIGNER DASHBOARD
        // ============================================

        function renderAssignerDashboard() {
            // Calculate stats
            const totalTasks = DataStore.tasks.length;
            const pendingTasks = DataStore.tasks.filter(t => t.status === 'pending').length;
            const inProgressTasks = DataStore.tasks.filter(t => t.status === 'in-progress').length;
            const completedTasks = DataStore.tasks.filter(t => t.status === 'completed').length;
            const overdueTasks = DataStore.tasks.filter(t => {
                return t.status !== 'completed' && new Date(t.dueDate) < new Date();
            }).length;

            // Render stats
            // Render stats
            document.getElementById('assignerStats').innerHTML = `
                <div class="stat-card" onclick="navigateToTaskOverview('')">
                    <div class="stat-label">Total Tasks</div>
                    <div class="stat-value">${totalTasks}</div>
                    <div class="stat-change positive">‚Üë 12% from last week</div>
                </div>
                <div class="stat-card" onclick="navigateToTaskOverview('pending')">
                    <div class="stat-label">Pending</div>
                    <div class="stat-value">${pendingTasks}</div>
                </div>
                <div class="stat-card" onclick="navigateToTaskOverview('in-progress')">
                    <div class="stat-label">In Progress</div>
                    <div class="stat-value">${inProgressTasks}</div>
                </div>
                <div class="stat-card" onclick="navigateToTaskOverview('completed')">
                    <div class="stat-label">Completed</div>
                    <div class="stat-value">${completedTasks}</div>
                    <div class="stat-change positive">‚Üë 8% improvement</div>
                </div>
                <div class="stat-card" onclick="navigateToTaskOverview('overdue')">
                    <div class="stat-label">Overdue</div>
                    <div class="stat-value" style="color: var(--danger);">${overdueTasks}</div>
                </div>
            `;

            // Render recent tasks
            const recentTasks = DataStore.tasks.slice(0, 5);
            document.getElementById('recentTasksTable').innerHTML = recentTasks.map(task => {
                const assignee = DataStore.teamMembers.find(m => m.id === task.assigneeId);
                return `
                    <tr class="clickable-row" onclick="viewTaskDetail(${task.id})">
                        <td><strong>${task.title}</strong></td>
                        <td>${assignee ? assignee.name : '<span style="color: var(--gray-400);">Unassigned</span>'}</td>
                        <td><span class="status-badge status-${task.status}">${formatStatus(task.status)}</span></td>
                        <td>${formatDate(task.dueDate)}</td>
                    </tr>
                `;
            }).join('');

            // Render team performance
            document.getElementById('teamPerformanceList').innerHTML = DataStore.teamMembers.slice(0, 4).map(member => {
                const memberTasks = DataStore.tasks.filter(t => t.assigneeId === member.id);
                const completedCount = memberTasks.filter(t => t.status === 'completed').length;
                const totalCount = memberTasks.length;
                const percentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;

                return `
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--gray-100);">
                        <div class="user-avatar">${member.avatar}</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">${member.name}</div>
                            <div style="font-size: 12px; color: var(--gray-500);">${completedCount}/${totalCount} tasks completed</div>
                        </div>
                        <div style="width: 80px;">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percentage}%;"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // CREATE TASK
        // ============================================

        document.getElementById('createTaskForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                dueDate: document.getElementById('taskDueDate').value,
                category: document.getElementById('taskCategory').value,
                estimatedHours: parseInt(document.getElementById('taskHours').value) || 4,
                staffInstructions: document.getElementById('taskStaffInstructions').value || ''
            };

            DataStore.addTask(taskData);

            // Clear staff instructions field
            document.getElementById('taskStaffInstructions').value = '';

            showToast('Task created successfully!', 'success');
            navigateTo('assign-task');
        });

        // ============================================
        // ASSIGN TASK PAGE
        // ============================================

        function renderAssignTaskPage() {
            const unassignedTasks = DataStore.tasks.filter(t => t.assigneeId === null);

            if (unassignedTasks.length === 0) {
                document.getElementById('unassignedTasksTable').innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray-500);">
                            No unassigned tasks. <a href="#" onclick="navigateTo('create-task')">Create a new task</a>
                        </td>
                    </tr>
                `;
                return;
            }

            document.getElementById('unassignedTasksTable').innerHTML = unassignedTasks.map(task => `
                <tr>
                    <td><strong>${task.title}</strong></td>
                    <td><span class="priority-badge priority-${task.priority}">${task.priority}</span></td>
                    <td>${formatCategory(task.category)}</td>
                    <td>${formatDate(task.dueDate)}</td>
                    <td>
                        <select id="assignee-${task.id}" class="filter-input" style="width: 150px;">
                            <option value="">Select...</option>
                            ${DataStore.teamMembers.map(m => `<option value="${m.id}">${m.name}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="quickAssign(${task.id})">Assign</button>
                    </td>
                </tr>
            `).join('');
        }

        /**
         * Quick assign task from assign page
         */
        function quickAssign(taskId) {
            const select = document.getElementById(`assignee-${taskId}`);
            const assigneeId = parseInt(select.value);

            if (!assigneeId) {
                showToast('Please select a team member', 'error');
                return;
            }

            const task = DataStore.tasks.find(t => t.id === taskId);
            const assignee = DataStore.teamMembers.find(m => m.id === assigneeId);

            if (task && assignee) {
                task.assigneeId = assigneeId;
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: `Assigned to ${assignee.name}`
                });

                DataStore.addNotification(`Task "${task.title}" assigned to ${assignee.name}`, taskId);

                showToast(`Task assigned to ${assignee.name}`, 'success');
                renderAssignTaskPage();
            }
        }

        // ============================================
        // TASK OVERVIEW
        // ============================================

        function renderTaskOverview() {
            // Populate assignee filter
            const filterAssignee = document.getElementById('filterAssignee');
            filterAssignee.innerHTML = `
                <option value="">All Assignees</option>
                <option value="unassigned">Unassigned</option>
                ${DataStore.teamMembers.map(m => `<option value="${m.id}">${m.name}</option>`).join('')}
            `;

            filterTasks();
        }

        /**
         * Filter tasks based on current filter selections
         */
        function filterTasks() {
            const statusFilter = document.getElementById('filterStatus').value;
            const priorityFilter = document.getElementById('filterPriority').value;
            const assigneeFilter = document.getElementById('filterAssignee').value;

            let filteredTasks = [...DataStore.tasks];

            if (statusFilter) {
                if (statusFilter === 'overdue') {
                    filteredTasks = filteredTasks.filter(t => {
                        return t.status !== 'completed' && new Date(t.dueDate) < new Date();
                    });
                } else {
                    filteredTasks = filteredTasks.filter(t => t.status === statusFilter);
                }
            }
            if (priorityFilter) {
                filteredTasks = filteredTasks.filter(t => t.priority === priorityFilter);
            }

            if (assigneeFilter) {
                if (assigneeFilter === 'unassigned') {
                    filteredTasks = filteredTasks.filter(t => t.assigneeId === null);
                } else {
                    filteredTasks = filteredTasks.filter(t => t.assigneeId === parseInt(assigneeFilter));
                }
            }
            if (assigneeFilter) {
                if (assigneeFilter === 'unassigned') {
                    filteredTasks = filteredTasks.filter(t => t.assigneeId === null);
                } else {
                    filteredTasks = filteredTasks.filter(t => t.assigneeId === parseInt(assigneeFilter));
                }
            }

            document.getElementById('allTasksTable').innerHTML = filteredTasks.map(task => {
                const assignee = DataStore.teamMembers.find(m => m.id === task.assigneeId);
                return `
                    <tr class="clickable-row" onclick="viewTaskDetail(${task.id})">
                        <td>#${task.id}</td>
                        <td><strong>${task.title}</strong></td>
                        <td>
                            ${assignee ? assignee.name : '<span style="color: var(--gray-400);">Unassigned</span>'}
                            ${task.needsHelp ? '<span class="status-badge" style="background: #fff1f0; color: #cf1322; border: 1px solid #ffccc7; margin-left: 6px; font-size: 10px;">‚ö†Ô∏è Help</span>' : ''}
                            ${task.status === 'cannot-complete' ? '<span class="status-badge" style="background: #fff1f0; color: #cf1322; border: 1px solid #ffccc7; margin-left: 6px; font-size: 10px;">üõë Cannot Complete</span>' : ''}
                        </td>
                        <td><span class="priority-badge priority-${task.priority}">${task.priority}</span></td>
                        <td><span class="status-badge status-${task.status}">${formatStatus(task.status)}</span></td>
                        <td>${formatDate(task.dueDate)}</td>
                        <td class="table-actions" onclick="event.stopPropagation()">
                            <button class="action-btn" onclick="viewTaskDetail(${task.id})">View</button>
                            ${!task.assigneeId ? `<button class="action-btn" onclick="openAssignModal(${task.id})">Assign</button>` : ''}
                        </td>
                    </tr>
                `;
            }).join('');

            if (filteredTasks.length === 0) {
                document.getElementById('allTasksTable').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray-500);">
                            No tasks match the current filters.
                        </td>
                    </tr>
                `;
            }
        }

        /**
         * Navigate to task overview with specific filter
         */
        function navigateToTaskOverview(filterStatus) {
            navigateTo('task-overview');
            // Small delay to ensure page renders
            setTimeout(() => {
                const statusSelect = document.getElementById('filterStatus');
                if (statusSelect) {
                    statusSelect.value = filterStatus || '';
                    filterTasks();
                }
            }, 50);
        }

        // ============================================
        // TASK DETAIL - ASSIGNER VIEW
        // ============================================

        function viewTaskDetail(taskId) {
            currentTaskId = taskId;
            const task = DataStore.tasks.find(t => t.id === taskId);

            if (!task) {
                showToast('Task not found', 'error');
                return;
            }

            const assignee = DataStore.teamMembers.find(m => m.id === task.assigneeId);

            if (DataStore.currentRole === 'assigner') {
                renderAssignerTaskDetail(task, assignee);
                navigateTo('task-detail-assigner');
            } else {
                renderExecutorTaskDetail(task, assignee);
                navigateTo('task-detail-executor');
            }
        }

        function renderAssignerTaskDetail(task, assignee) {
            document.getElementById('taskDetailAssignerContent').innerHTML = `
                <div class="card">
                    <div class="task-detail-header">
                        <div>
                            <h2 class="task-detail-title">${task.title}</h2>
                            <div style="display: flex; gap: 12px;">
                                <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                                <span class="status-badge status-${task.status}">${formatStatus(task.status)}</span>
                                ${task.approvalStatus ? `<span class="status-badge status-${task.approvalStatus}">${formatStatus(task.approvalStatus)}</span>` : ''}
                            </div>
                        </div>
                        <div class="task-detail-actions">
                            ${!task.assigneeId ? `<button class="btn btn-primary" onclick="openAssignModal(${task.id})">Assign Task</button>` : ''}
                            ${task.status === 'completed' && task.approvalStatus !== 'approved' ? `
                                <button class="btn btn-success" onclick="approveTask(${task.id})">Approve</button>
                                <button class="btn btn-danger" onclick="rejectTask(${task.id})">Reject</button>
                            ` : ''}
                            <button class="btn btn-secondary" onclick="deleteTask(${task.id})">Delete</button>
                        </div>
                    </div>

                    ${task.needsHelp ? `
                        <div style="background-color: #fff1f0; border: 1px solid #ffccc7; padding: 16px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: flex-start; gap: 16px;">
                            <div style="font-size: 24px;">üö®</div>
                            <div style="flex: 1;">
                                <h4 style="color: #cf1322; margin: 0 0 4px 0; font-size: 16px;">Help Requested</h4>
                                <p style="margin: 0 0 12px 0; color: #434343;"><strong>Reason:</strong> ${task.helpNeededReason}</p>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-sm btn-outline-danger" style="background: white; border-color: #ffccc7; color: #cf1322;" onclick="resolveHelpRequest(${task.id})">Mark as Resolved</button>
                                    <button class="btn btn-sm btn-outline-danger" style="background: white; border-color: #ffccc7; color: #cf1322;" onclick="openAssignModal(${task.id})">Reassign / Add Staff</button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    ${task.status === 'cannot-complete' ? `
                        <div style="background-color: #fff1f0; border: 1px solid #ffccc7; padding: 16px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: flex-start; gap: 16px;">
                            <div style="font-size: 24px;">‚ùå</div>
                            <div style="flex: 1;">
                                <h4 style="color: #cf1322; margin: 0 0 4px 0; font-size: 16px;">Task Cannot Be Completed</h4>
                                <p style="margin: 0 0 12px 0; color: #434343;"><strong>Reason:</strong> ${task.cannotCompleteReason}</p>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-sm btn-outline-danger" style="background: white; border-color: #ffccc7; color: #cf1322;" onclick="openAssignModal(${task.id})">Reassign / Send More People</button>
                                    <button class="btn btn-sm btn-secondary" style="background: white;" onclick="deleteTask(${task.id})">Cancel Task</button>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="task-info-grid">
                        <div class="task-info-item">
                            <div class="task-info-label">Task ID</div>
                            <div class="task-info-value">#${task.id}</div>
                        </div>
                        <div class="task-info-item">
                            <div class="task-info-label">Assigned To</div>
                            <div class="task-info-value">${assignee ? assignee.name : 'Unassigned'}</div>
                        </div>
                        <div class="task-info-item">
                            <div class="task-info-label">Category</div>
                            <div class="task-info-value">${formatCategory(task.category)}</div>
                        </div>
                        <div class="task-info-item">
                            <div class="task-info-label">Due Date</div>
                            <div class="task-info-value">${formatDate(task.dueDate)}</div>
                        </div>
                        <div class="task-info-item">
                            <div class="task-info-label">Created</div>
                            <div class="task-info-value">${DataStore.formatDateTime(task.createdAt)}</div>
                        </div>
                        <div class="task-info-item">
                            <div class="task-info-label">Est. Hours</div>
                            <div class="task-info-value">${task.estimatedHours}h</div>
                        </div>
                    </div>
                    
                    <h4 style="margin-bottom: 8px;">Description</h4>
                    <p style="color: var(--gray-600); margin-bottom: 24px;">${task.description || 'No description provided.'}</p>
                    
                    ${task.notes ? `
                        <h4 style="margin-bottom: 8px;">Latest Notes</h4>
                        <p style="color: var(--gray-600); margin-bottom: 24px; padding: 12px; background: var(--gray-50); border-radius: 6px;">${task.notes}</p>
                    ` : ''}
                    
                    <h4 style="margin-bottom: 16px;">Activity Timeline</h4>
                    <div class="timeline">
                        ${task.timeline.map(item => `
                            <div class="timeline-item">
                                <div class="timeline-time">${item.time}</div>
                                <div class="timeline-content">${item.action}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        /**
         * Resolve help request
         */
        function resolveHelpRequest(taskId) {
            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                task.needsHelp = false;
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: 'Help request marked as resolved by Assigner'
                });
                showToast('Help request resolved', 'success');
                renderAssignerTaskDetail(task, DataStore.teamMembers.find(m => m.id === task.assigneeId));
            }
        }

        // ============================================
        // TEAM VIEW
        // ============================================

        function renderTeamView() {
            document.getElementById('teamMembersGrid').innerHTML = DataStore.teamMembers.map(member => {
                const memberTasks = DataStore.tasks.filter(t => t.assigneeId === member.id);
                const activeTasks = memberTasks.filter(t => t.status !== 'completed').length;
                const completedTasks = memberTasks.filter(t => t.status === 'completed').length;

                return `
                    <div class="team-member-card">
                        <div class="team-member-avatar">${member.avatar}</div>
                        <div class="team-member-name">${member.name}</div>
                        <div class="team-member-role">${member.role}</div>
                        <div style="margin-bottom: 12px; font-size: 13px; color: var(--gray-500);">${member.department}</div>
                        <div class="team-member-stats">
                            <div>
                                <strong>${activeTasks}</strong>
                                <div style="color: var(--gray-500);">Active</div>
                            </div>
                            <div>
                                <strong>${completedTasks}</strong>
                                <div style="color: var(--gray-500);">Done</div>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-secondary" style="margin-top: 16px;" onclick="viewMemberTasks(${member.id})">View Tasks</button>
                    </div>
                `;
            }).join('');
        }

        /**
         * View tasks for specific team member
         */
        function viewMemberTasks(memberId) {
            document.getElementById('filterAssignee').value = memberId;
            navigateTo('task-overview');
        }

        // ============================================
        // REPORTS
        // ============================================

        function renderReports() {
            const totalTasks = DataStore.tasks.length;
            const completedTasks = DataStore.tasks.filter(t => t.status === 'completed').length;
            const avgCompletionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            const totalHours = DataStore.tasks.reduce((sum, t) => sum + (t.estimatedHours || 0), 0);

            document.getElementById('reportStats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Tasks Created</div>
                    <div class="stat-value">${totalTasks}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Tasks Completed</div>
                    <div class="stat-value">${completedTasks}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Completion Rate</div>
                    <div class="stat-value">${avgCompletionRate}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Hours Estimated</div>
                    <div class="stat-value">${totalHours}h</div>
                </div>
            `;

            // Simple status chart (text-based for no external dependencies)
            const statusCounts = {
                pending: DataStore.tasks.filter(t => t.status === 'pending').length,
                'in-progress': DataStore.tasks.filter(t => t.status === 'in-progress').length,
                completed: DataStore.tasks.filter(t => t.status === 'completed').length,
            };

            document.getElementById('statusChart').innerHTML = Object.entries(statusCounts).map(([status, count]) => {
                const percentage = totalTasks > 0 ? Math.round((count / totalTasks) * 100) : 0;
                return `
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span>${formatStatus(status)}</span>
                            <span>${count} (${percentage}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%; background: ${getStatusColor(status)};"></div>
                        </div>
                    </div>
                `;
            }).join('');

            // Category chart
            const categories = ['maintenance', 'administrative', 'facilities', 'supplies', 'events', 'other'];
            document.getElementById('categoryChart').innerHTML = categories.map(cat => {
                const count = DataStore.tasks.filter(t => t.category === cat).length;
                const percentage = totalTasks > 0 ? Math.round((count / totalTasks) * 100) : 0;
                return `
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <span>${formatCategory(cat)}</span>
                            <span>${count}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%;"></div>
                        </div>
                    </div>
                `;
            }).join('');

            // Productivity table
            document.getElementById('productivityTable').innerHTML = DataStore.teamMembers.map(member => {
                const memberTasks = DataStore.tasks.filter(t => t.assigneeId === member.id);
                const assigned = memberTasks.length;
                const completed = memberTasks.filter(t => t.status === 'completed').length;
                const inProgress = memberTasks.filter(t => t.status === 'in-progress').length;
                const overdue = memberTasks.filter(t => t.status !== 'completed' && new Date(t.dueDate) < new Date()).length;
                const rate = assigned > 0 ? Math.round((completed / assigned) * 100) : 0;

                return `
                    <tr>
                        <td><strong>${member.name}</strong></td>
                        <td>${assigned}</td>
                        <td>${completed}</td>
                        <td>${inProgress}</td>
                        <td style="color: ${overdue > 0 ? 'var(--danger)' : 'inherit'};">${overdue}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="progress-bar" style="width: 60px;">
                                    <div class="progress-fill" style="width: ${rate}%;"></div>
                                </div>
                                ${rate}%
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ============================================
        // EXECUTOR DASHBOARD
        // ============================================

        /**
         * Render task-first Executor Dashboard with large cards
         */
        function renderExecutorDashboard(filter = 'today') {
            // Assuming executor is team member with ID 1 for demo
            const executorId = 1;
            const myTasks = DataStore.tasks.filter(t => t.assigneeId === executorId && t.status !== 'completed');

            // Get today's date (start of day)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            // Filter tasks due today
            const todayTasks = myTasks.filter(t => {
                const dueDate = new Date(t.dueDate);
                return dueDate >= today && dueDate < tomorrow;
            });

            // Update filter buttons
            document.querySelectorAll('.executor-filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if ((filter === 'today' && btn.textContent.includes('Today')) ||
                    (filter === 'all' && btn.textContent.includes('All'))) {
                    btn.classList.add('active');
                }
            });

            const todayContainer = document.getElementById('executorTodayTasks');
            const allTasksSection = document.getElementById('allTasksSection');
            const allTasksContainer = document.getElementById('executorAllTasks');

            // Show/hide sections based on filter
            if (filter === 'all') {
                allTasksSection.style.display = 'flex';
                allTasksContainer.style.display = 'block';
                todayContainer.style.display = 'none';
                document.querySelector('.executor-section-title').innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20" style="fill: currentColor; vertical-align: middle; margin-right: 6px;"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>All Pending Tasks';

                if (myTasks.length === 0) {
                    allTasksContainer.innerHTML = `
                        <div class="executor-empty-state">
                            <div class="executor-empty-state-icon"><svg viewBox="0 0 24 24" width="48" height="48" style="fill: currentColor;"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg></div>
                            <div class="executor-empty-state-text">No pending tasks assigned to you.</div>
                        </div>
                    `;
                } else {
                    allTasksContainer.innerHTML = myTasks.map(task => renderExecutorTaskCard(task)).join('');
                }
            } else {
                allTasksSection.style.display = 'none';
                allTasksContainer.style.display = 'none';
                todayContainer.style.display = 'block';
                document.querySelector('.executor-section-title').innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20" style="fill: currentColor; vertical-align: middle; margin-right: 6px;"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10zM5 7V5h14v2H5z"/></svg>Tasks for Today';

                if (todayTasks.length === 0) {
                    todayContainer.innerHTML = `
                        <div class="executor-empty-state">
                            <div class="executor-empty-state-icon"><svg viewBox="0 0 24 24" width="48" height="48" style="fill: #4caf50;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                            <div class="executor-empty-state-text">No tasks due today. Great job!</div>
                        </div>
                    `;
                } else {
                    todayContainer.innerHTML = todayTasks.map(task => renderExecutorTaskCard(task)).join('');
                }
            }
        }

        /**
         * Filter executor tasks (Today/All)
         */
        function filterExecutorTasks(filter) {
            renderExecutorDashboard(filter);
        }

        /**
         * Render a single large task card for Executor
         */
        function renderExecutorTaskCard(task) {
            const isOverdue = new Date(task.dueDate) < new Date() && task.status !== 'completed';
            return `
                <div class="task-card-large" onclick="viewTaskDetail(${task.id})">
                    <div class="task-card-large-title">${task.title}</div>
                    <div class="task-card-large-meta">
                        <span><svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; vertical-align: middle; margin-right: 4px;"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10zM5 7V5h14v2H5z"/></svg>Due: ${formatDate(task.dueDate)}${isOverdue ? ' <strong style="color: var(--danger);">(Overdue!)</strong>' : ''}</span>
                        <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                        <span class="status-badge status-${task.status}">${formatStatus(task.status)}</span>
                    </div>
                    <div class="task-card-large-action">
                        <button class="btn btn-primary"><svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; vertical-align: middle; margin-right: 4px;"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>View Task</button>
                    </div>
                </div>
            `;
        }

        // ============================================
        // TASK DETAIL - EXECUTOR VIEW
        // ============================================

        function renderExecutorTaskDetail(task, assignee) {
            const canStart = task.status === 'pending';
            const canComplete = task.status === 'in-progress';
            const isCompleted = task.status === 'completed' || task.status === 'cannot-complete';

            // Generate staff instructions - use custom or generate from description
            const staffInstructions = task.staffInstructions || generateDefaultInstructions(task);

            document.getElementById('taskDetailExecutorContent').innerHTML = `
                <div class="card">
                    <!-- Task Title & Status -->
                    <div style="margin-bottom: 24px;">
                        <h2 class="task-detail-title" style="font-size: 24px; margin-bottom: 12px;">${task.title}</h2>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <span class="priority-badge priority-${task.priority}">${task.priority} Priority</span>
                            <span class="status-badge status-${task.status}">${formatStatus(task.status)}</span>
                            <span style="color: var(--gray-500);"><svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; vertical-align: middle; margin-right: 4px;"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10zM5 7V5h14v2H5z"/></svg>Due: ${formatDate(task.dueDate)}</span>
                        </div>
                    </div>

                    <!-- INSTRUCTION BOX - "What you need to do" -->
                    <div class="instruction-box">
                        <h3><svg viewBox="0 0 24 24" width="20" height="20" style="fill: currentColor; vertical-align: middle; margin-right: 8px;"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>What you need to do</h3>
                        <ol>
                            ${staffInstructions.split('\n').filter(line => line.trim()).map(line =>
                `<li>${line.replace(/^\d+\.\s*/, '')}</li>`
            ).join('')}
                        </ol>
                    </div>

                    <!-- COMPLETION HINT -->
                    ${!isCompleted ? `
                        <div class="completion-hint">
                            <svg viewBox="0 0 24 24" width="16" height="16" style="fill: #4a90e2; vertical-align: middle; margin-right: 6px;"><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6A4.997 4.997 0 0 1 7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"/></svg>Once the job is completed, click <strong>"Mark as Done"</strong> to update the system.
                        </div>
                    ` : ''}

                    <!-- Additional Info (minimal) -->
                    <div style="margin-bottom: 24px; color: var(--gray-600);">
                        <p><strong>Category:</strong> ${formatCategory(task.category)}</p>
                        ${task.description ? `<p style="margin-top: 8px;">${task.description}</p>` : ''}
                    </div>

                    <!-- Cannot Complete Reason Field (hidden by default) -->
                    <div id="cannotCompleteReason" class="reason-field">
                        <label><svg viewBox="0 0 24 24" width="16" height="16" style="fill: #ff9800; vertical-align: middle; margin-right: 6px;"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>Why can't you complete this task?</label>
                        <textarea id="reasonText" placeholder="Please explain why you cannot complete this task..."></textarea>
                    </div>

                    <!-- Request Help Reason Field (hidden by default) -->
                    <div id="requestHelpReason" class="reason-field" style="display: none;">
                        <label><svg viewBox="0 0 24 24" width="16" height="16" style="fill: #4a90e2; vertical-align: middle; margin-right: 6px;"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>What kind of help do you need?</label>
                        <textarea id="helpReasonText" placeholder="Describe what help you need (e.g., need 1 more person, need specialist, need equipment...)"></textarea>
                    </div>

                    <!-- LARGE ACTION BUTTONS -->
                    ${!isCompleted ? `
                        <div class="executor-actions">
                            ${canStart ? `
                                <button id="btnStart" class="executor-btn executor-btn-primary" onclick="executorStartTask(${task.id})">
                                    <svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; vertical-align: middle; margin-right: 4px;"><path d="M8 5v14l11-7z"/></svg>Start Working
                                </button>
                            ` : ''}
                            ${canComplete ? `
                                <button id="btnComplete" class="executor-btn executor-btn-primary" onclick="executorCompleteTask(${task.id})">
                                    <svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; vertical-align: middle; margin-right: 4px;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>Mark as Done
                                </button>
                            ` : ''}
                            <button id="btnHelp" class="executor-btn executor-btn-warning" onclick="toggleRequestHelp()">
                                <svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; vertical-align: middle; margin-right: 4px;"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>Request Help
                            </button>
                            <button id="btnCannot" class="executor-btn executor-btn-danger" onclick="toggleCannotComplete()">
                                <svg viewBox="0 0 24 24" width="14" height="14" style="fill: currentColor; vertical-align: middle; margin-right: 4px;"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>Cannot Complete
                            </button>
                            <button id="submitCannotComplete" class="executor-btn executor-btn-danger" style="display: none; width: 100%; justify-content: center; margin-top: 8px;" onclick="submitCannotComplete(${task.id})">
                                Submit Issue
                            </button>
                            <button id="submitRequestHelp" class="executor-btn executor-btn-warning" style="display: none; width: 100%; justify-content: center; margin-top: 8px;" onclick="submitRequestHelp(${task.id})">
                                Send Help Request
                            </button>
                        </div>
                    ` : `
                        <div class="executor-empty-state" style="padding: 20px;">
                            <div class="executor-empty-state-icon"><svg viewBox="0 0 24 24" width="48" height="48" style="fill: #4caf50;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                            <div class="executor-empty-state-text">This task has been completed!</div>
                        </div>
                    `}
                </div>
            `;
        }

        /**
         * Generate default instructions from task description
         */
        function generateDefaultInstructions(task) {
            return `1. Go to the specified location
2. ${task.title}
3. Once finished, click Mark as Done`;
        }

        /**
         * Toggle Cannot Complete reason field
         */
        function toggleCannotComplete() {
            const reasonField = document.getElementById('cannotCompleteReason');
            const submitBtn = document.getElementById('submitCannotComplete');
            const isActive = reasonField.classList.toggle('active');

            submitBtn.style.display = isActive ? 'flex' : 'none';

            // Toggle other buttons visibility
            toggleActionButtons(!isActive);
        }

        /**
         * Submit Cannot Complete with reason
         */
        function submitCannotComplete(taskId) {
            const reason = document.getElementById('reasonText').value.trim();
            if (!reason) {
                showToast('Please provide a reason', 'error');
                return;
            }

            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'cannot-complete';
                task.cannotCompleteReason = reason;
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: `MARKED AS CANNOT COMPLETE: ${reason}`
                });

                // Add Action Required Notification
                DataStore.addNotification(`üî¥ ACTION REQUIRED: Task "${task.title}" marked as Cannot Complete: ${reason}`, taskId);

                showToast('Status updated', 'success');

                // Refresh to show updated status
                viewTaskDetail(taskId);
            }
        }

        /**
         * Toggle Request Help reason field
         */
        function toggleRequestHelp() {
            const reasonField = document.getElementById('requestHelpReason');
            const submitBtn = document.getElementById('submitRequestHelp');

            // Toggle active class
            const isActive = reasonField.classList.toggle('active');

            // Explicitly handle display property because of inline style or CSS priority
            reasonField.style.display = isActive ? 'block' : 'none';
            submitBtn.style.display = isActive ? 'flex' : 'none';

            // Toggle other buttons visibility
            toggleActionButtons(!isActive);
        }

        /**
         * Helper to show/hide main action buttons
         */
        function toggleActionButtons(show) {
            const display = show ? 'flex' : 'none';
            if (document.getElementById('btnStart')) document.getElementById('btnStart').style.display = display;
            if (document.getElementById('btnComplete')) document.getElementById('btnComplete').style.display = display;
            if (document.getElementById('btnHelp')) document.getElementById('btnHelp').style.display = display;
            if (document.getElementById('btnCannot')) document.getElementById('btnCannot').style.display = display;
        }

        /**
         * Submit Request Help with reason
         */
        function submitRequestHelp(taskId) {
            const reason = document.getElementById('helpReasonText').value.trim();
            if (!reason) {
                showToast('Please describe what help you need', 'error');
                return;
            }

            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                // Set help needed flag
                task.needsHelp = true;
                task.helpNeededReason = reason;

                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: `REQUESTED HELP: ${reason}`
                });
                DataStore.addNotification(`üî¥ ACTION REQUIRED: Help requested for task "${task.title}": ${reason}`, taskId);
                showToast('Help request sent to supervisor', 'success');

                // Hide the form
                toggleRequestHelp();

                // Clear the text
                document.getElementById('helpReasonText').value = '';

                // Refresh view
                viewTaskDetail(taskId);
            }
        }

        /**
         * Executor starts a task
         */
        function executorStartTask(taskId) {
            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'in-progress';
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: 'Started working on task'
                });
                DataStore.addNotification(`Task "${task.title}" started`, taskId);
                showToast('Task started! Good luck!', 'success');
                viewTaskDetail(taskId);
            }
        }

        /**
         * Executor completes a task
         */
        function executorCompleteTask(taskId) {
            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'completed';
                task.completedAt = new Date().toISOString();
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: 'Task completed'
                });
                DataStore.addNotification(`Task "${task.title}" completed - awaiting approval`, taskId);
                showToast('Great job! Task marked as complete.', 'success');
                navigateTo('executor-dashboard');
                renderExecutorDashboard();
            }
        }

        /**
         * Start a task
         */
        function startTask(taskId) {
            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'in-progress';
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: 'Status changed to In Progress'
                });
                DataStore.addNotification(`Task "${task.title}" started`, taskId);
                showToast('Task started!', 'success');
                renderExecutorDashboard();
                viewTaskDetail(taskId);
            }
        }

        /**
         * Save notes for a task
         */
        function saveNotes(taskId) {
            const task = DataStore.tasks.find(t => t.id === taskId);
            const notes = document.getElementById('executorNotes').value;
            if (task) {
                task.notes = notes;
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: 'Notes updated'
                });
                showToast('Notes saved!', 'success');
            }
        }

        // ============================================
        // UPDATE STATUS PAGE
        // ============================================

        function renderUpdateStatusPage() {
            const executorId = 1;
            const myActiveTasks = DataStore.tasks.filter(t =>
                t.assigneeId === executorId && t.status !== 'completed'
            );

            if (myActiveTasks.length === 0) {
                document.getElementById('statusUpdateTable').innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray-500);">
                            No active tasks to update.
                        </td>
                    </tr>
                `;
                return;
            }

            document.getElementById('statusUpdateTable').innerHTML = myActiveTasks.map(task => `
                <tr>
                    <td><strong>${task.title}</strong></td>
                    <td><span class="priority-badge priority-${task.priority}">${task.priority}</span></td>
                    <td><span class="status-badge status-${task.status}">${formatStatus(task.status)}</span></td>
                    <td>${formatDate(task.dueDate)}</td>
                    <td class="table-actions">
                        ${task.status === 'pending' ?
                    `<button class="btn btn-sm btn-primary" onclick="startTask(${task.id})">Start</button>` :
                    `<button class="btn btn-sm btn-success" onclick="completeTask(${task.id})">Complete</button>`
                }
                        <button class="btn btn-sm btn-secondary" onclick="viewTaskDetail(${task.id})">Details</button>
                    </td>
                </tr>
            `).join('');
        }

        /**
         * Complete a task
         */
        function completeTask(taskId) {
            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'completed';
                task.completedAt = new Date().toISOString();
                task.approvalStatus = 'pending';
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: 'Task completed - Awaiting approval'
                });
                DataStore.addNotification(`Task "${task.title}" completed - Awaiting approval`, taskId);
                showToast('Task marked as complete!', 'success');
                renderUpdateStatusPage();
            }
        }

        // ============================================
        // COMPLETED TASKS
        // ============================================

        function renderCompletedTasks() {
            const executorId = 1;
            const completedTasks = DataStore.tasks.filter(t =>
                t.assigneeId === executorId && t.status === 'completed'
            );

            if (completedTasks.length === 0) {
                document.getElementById('completedTasksTable').innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray-500);">
                            No completed tasks yet.
                        </td>
                    </tr>
                `;
                return;
            }

            document.getElementById('completedTasksTable').innerHTML = completedTasks.map(task => `
                <tr>
                    <td><strong>${task.title}</strong></td>
                    <td>${formatCategory(task.category)}</td>
                    <td>${task.completedAt ? DataStore.formatDateTime(task.completedAt) : '-'}</td>
                    <td><span class="status-badge status-${task.approvalStatus || 'pending'}">${formatStatus(task.approvalStatus || 'pending')}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewTaskDetail(${task.id})">View</button>
                    </td>
                </tr>
            `).join('');
        }

        // ============================================
        // TASK APPROVAL (Assigner Actions)
        // ============================================

        function approveTask(taskId) {
            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                task.approvalStatus = 'approved';
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: 'Task approved by Admin'
                });
                DataStore.addNotification(`Task "${task.title}" has been approved`, taskId);
                showToast('Task approved!', 'success');
                viewTaskDetail(taskId);
            }
        }

        function rejectTask(taskId) {
            const task = DataStore.tasks.find(t => t.id === taskId);
            if (task) {
                task.approvalStatus = 'rejected';
                task.status = 'in-progress'; // Send back to in-progress
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: 'Task rejected by Admin - Needs revision'
                });
                DataStore.addNotification(`Task "${task.title}" was rejected - Please revise`, taskId);
                showToast('Task rejected and sent back for revision', 'error');
                viewTaskDetail(taskId);
            }
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                DataStore.tasks = DataStore.tasks.filter(t => t.id !== taskId);
                showToast('Task deleted', 'success');
                navigateTo('task-overview');
            }
        }

        // ============================================
        // MODALS
        // ============================================

        function openAssignModal(taskId) {
            currentTaskId = taskId;
            const task = DataStore.tasks.find(t => t.id === taskId);

            document.getElementById('assignTaskName').textContent = task.title;
            document.getElementById('assigneeSelect').innerHTML = `
                <option value="">Select team member...</option>
                ${DataStore.teamMembers.map(m => `<option value="${m.id}">${m.name} - ${m.role}</option>`).join('')}
            `;
            document.getElementById('assignNotes').value = '';

            document.getElementById('assignModal').classList.add('active');
        }

        function confirmAssignment() {
            const assigneeId = parseInt(document.getElementById('assigneeSelect').value);
            const notes = document.getElementById('assignNotes').value;

            if (!assigneeId) {
                showToast('Please select a team member', 'error');
                return;
            }

            const task = DataStore.tasks.find(t => t.id === currentTaskId);
            const assignee = DataStore.teamMembers.find(m => m.id === assigneeId);

            if (task && assignee) {
                task.assigneeId = assigneeId;
                if (notes) {
                    task.notes = notes;
                }
                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: `Assigned to ${assignee.name}`
                });

                DataStore.addNotification(`New task assigned: "${task.title}"`, task.id);

                closeModal('assignModal');
                showToast(`Task assigned to ${assignee.name}`, 'success');

                // Refresh current view
                renderPage(document.querySelector('.page.active').id.replace('page-', ''));
            }
        }

        function openStatusModal(taskId) {
            currentTaskId = taskId;
            const task = DataStore.tasks.find(t => t.id === taskId);

            document.getElementById('statusTaskName').textContent = task.title;
            document.getElementById('newStatusSelect').value = task.status;
            document.getElementById('statusNotes').value = '';

            document.getElementById('statusModal').classList.add('active');
        }

        function confirmStatusUpdate() {
            const newStatus = document.getElementById('newStatusSelect').value;
            const notes = document.getElementById('statusNotes').value;

            const task = DataStore.tasks.find(t => t.id === currentTaskId);

            if (task) {
                const oldStatus = task.status;
                task.status = newStatus;

                if (notes) {
                    task.notes = notes;
                }

                if (newStatus === 'completed') {
                    task.completedAt = new Date().toISOString();
                    task.approvalStatus = 'pending';
                }

                task.timeline.push({
                    time: DataStore.formatDateTime(new Date()),
                    action: `Status changed from ${formatStatus(oldStatus)} to ${formatStatus(newStatus)}`
                });

                if (notes) {
                    task.timeline.push({
                        time: DataStore.formatDateTime(new Date()),
                        action: `Note added: "${notes.substring(0, 50)}..."`
                    });
                }

                DataStore.addNotification(`Task "${task.title}" status updated to ${formatStatus(newStatus)}`, task.id);

                closeModal('statusModal');
                showToast('Status updated successfully!', 'success');

                viewTaskDetail(currentTaskId);
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            currentTaskId = null;
        }

        // Close modal on outside click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function (e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });

        // ============================================
        // NOTIFICATIONS
        // ============================================

        function toggleNotifications() {
            document.getElementById('notificationPanel').classList.toggle('active');
            closeUserMenu();
            renderNotifications();
        }

        function closeNotifications() {
            document.getElementById('notificationPanel').classList.remove('active');
        }

        function renderNotifications() {
            const notifications = DataStore.notifications.slice(0, 10);

            document.getElementById('notificationList').innerHTML = notifications.map(n => `
                <li class="notification-item ${n.read ? '' : 'unread'}" onclick="handleNotificationClick(${n.id}, ${n.taskId})">
                    <div class="notification-content">${n.message}</div>
                    <div class="notification-time">${n.time}</div>
                </li>
            `).join('');

            updateNotificationBadge();
        }

        function handleNotificationClick(notificationId, taskId) {
            // Mark as read
            const notification = DataStore.notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
            }

            closeNotifications();

            if (taskId) {
                viewTaskDetail(taskId);
            }

            updateNotificationBadge();
        }

        function markAllRead() {
            DataStore.notifications.forEach(n => n.read = true);
            renderNotifications();
            showToast('All notifications marked as read');
        }

        function updateNotificationBadge() {
            const count = DataStore.getUnreadCount();
            const badge = document.getElementById('notificationBadge');
            badge.textContent = count;
            badge.style.display = count > 0 ? 'block' : 'none';
        }

        function renderNotificationsPage() {
            document.getElementById('allNotificationsList').innerHTML = DataStore.notifications.map(n => `
                <li class="notification-item ${n.read ? '' : 'unread'}" onclick="handleNotificationClick(${n.id}, ${n.taskId})">
                    <div class="notification-content">${n.message}</div>
                    <div class="notification-time">${n.time}</div>
                </li>
            `).join('');
        }

        // ============================================
        // USER MENU
        // ============================================

        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('active');
            closeNotifications();
        }

        function closeUserMenu() {
            document.getElementById('userDropdown').classList.remove('active');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.dropdown') && !e.target.closest('.notification-btn')) {
                closeUserMenu();
            }
            if (!e.target.closest('.notification-panel') && !e.target.closest('.notification-btn')) {
                closeNotifications();
            }
        });

        // ============================================
        // PROFILE
        // ============================================

        function renderProfile() {
            // Profile is mostly static for demo
        }

        document.getElementById('profileForm').addEventListener('submit', function (e) {
            e.preventDefault();
            showToast('Profile updated successfully!', 'success');
        });

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function formatStatus(status) {
            const statusMap = {
                'pending': 'Pending',
                'in-progress': 'In Progress',
                'completed': 'Completed',
                'overdue': 'Overdue',
                'approved': 'Approved',
                'rejected': 'Rejected'
            };
            return statusMap[status] || status;
        }

        function formatCategory(category) {
            return category.charAt(0).toUpperCase() + category.slice(1);
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function getStatusColor(status) {
            const colors = {
                'pending': 'var(--warning)',
                'in-progress': 'var(--primary)',
                'completed': 'var(--success)',
                'overdue': 'var(--danger)'
            };
            return colors[status] || 'var(--gray-400)';
        }

        /**
         * Show toast notification
         */
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ============================================
        // THEME TOGGLE
        // ============================================

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('kalnet-theme', isDark ? 'dark' : 'light');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const themeIcon = document.getElementById('themeIcon');
            const isDark = document.body.classList.contains('dark-mode');

            if (isDark) {
                // Show Sun icon (to switch to light)
                themeIcon.innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20" style="fill: currentColor;"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg>';
            } else {
                // Show Moon icon (to switch to dark)
                themeIcon.innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20" style="fill: currentColor;"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>';
            }
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('kalnet-theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
            }
            updateThemeIcon();
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        // Initialize theme
        initTheme();

        // Set default due date for create task form
        document.getElementById('taskDueDate').valueAsDate = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);

        // Initialize notification badge
        updateNotificationBadge();

        console.log('KALNET Operations Module loaded successfully');
        console.log('Mock data initialized:', {
            tasks: DataStore.tasks.length,
            teamMembers: DataStore.teamMembers.length,
            notifications: DataStore.notifications.length
        });
        // ============================================
        // NOTIFICATIONS
        // ============================================

        // The toggleNotifications function was moved to replace the old one at the top.
        // The handleNotificationClick function was modified to accept only taskId and call the new toggleNotifications.

        function renderNotificationsDropdown() {
            const list = document.getElementById('notificationsList');
            const notifications = DataStore.notifications.slice(0, 5); // Show last 5

            if (notifications.length === 0) {
                list.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--gray-500);">No notifications</div>';
                return;
            }

            list.innerHTML = notifications.map(notif => {
                const isActionRequired = notif.message.includes('ACTION REQUIRED');
                const bgColor = isActionRequired ? '#fff1f0' : 'white';
                const textColor = isActionRequired ? '#cf1322' : 'var(--gray-800)';

                return `
                    <div class="notification-item" style="padding: 12px 16px; border-bottom: 1px solid var(--gray-50); background: ${bgColor}; cursor: pointer; transition: background 0.2s;" onclick="handleNotificationClick(${notif.taskId})">
                        <div style="font-size: 13px; color: ${textColor}; margin-bottom: 4px; font-weight: ${isActionRequired ? '600' : '400'};">
                            ${notif.message}
                        </div>
                        <div style="font-size: 11px; color: var(--gray-500);">${notif.time}</div>
                    </div>
                `;
            }).join('');
        }



        function updateNotificationBadge() {
            const count = DataStore.notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.textContent = count;
                badge.style.display = count > 0 ? 'block' : 'none';
            }
        }

        // Update User Menu Toggle to close notifications
        const originalToggleUserMenu = toggleUserMenu;
        toggleUserMenu = function () {
            document.getElementById('notificationsDropdown').style.display = 'none';
            const menu = document.getElementById('userDropdown');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        };

    </script>
</body>

</html>